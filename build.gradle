defaultTasks 'clean', 'injectLibs', 'snapshotNjgrSharedLibrary', 'installSnapshotTestExecutable', 'runTests'

// Apply plugins
apply plugin: 'c'

// Basic project information
group = 'LinkedNeurons'
archivesBaseName = 'njgr'
version = '1.0.0-SNAPSHOT'

// Extended project information
ext.projectName = 'NeuronsJustGotReal'
ext.inceptionYear = '2014'
ext.packaging = 'tar'
ext.url = ''
ext.description = 'A C library for neural networks.'
ext.organization = 'LinkedNeurons'

ext.cIncludes = project.hasProperty("cIncludes") ? cIncludes : '/usr/local/include'
ext.cLibs = project.hasProperty("cLibs") ? cLibs : '/usr/local/lib'

libraries {
    njgr {}
}

executables {
    test {
        binaries.all {
            cCompiler.args '-I', cIncludes
            linker.args '-L', cLibs
        }
    }
}

sources {
    njgr {
        c {
            source {
                include "**/*.c"
            }
        }
    }
    test {
        c {
            lib libraries.njgr
            source {
                include "**/*.c"
            }
        }
    }
}

buildTypes {
    debug {}
    snapshot {}
    release {}
}

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {}
}

task injectLibs << {
    linkSnapshotTestExecutable.doFirst {
        binaries.all {
            toolChain.linker.withArguments { args ->
                args << "-lcunit"
            }
        }
    }
}

task runTests(type:Exec) {
    workingDir './build/install/testExecutable/snapshot'
    commandLine './test'
}

task test {}
task snapshot {}
task release {}

binaries.all {
    cCompiler.args "-Wall"

    if (toolChain in Gcc || toolChain in Clang) {
        cCompiler.args "-Wextra"
        cCompiler.args "--std=c99"
        if (buildType == buildTypes.debug) {
            cCompiler.args "-g"
        } else {
            cCompiler.args "-O3"
        }
    }
}
