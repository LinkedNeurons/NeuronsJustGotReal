defaultTasks 'clean', 'injectLibs', 'njgrSharedLibrary', 'installTestExecutable', 'runTests'

// Apply plugins
apply plugin: 'c'

// Basic project information
group = 'LinkedNeurons'
archivesBaseName = 'njgr'
version = '1.0.0-SNAPSHOT'

// Extended project information
ext.projectName = 'NeuronsJustGotReal'
ext.inceptionYear = '2014'
ext.packaging = 'tar'
ext.url = ''
ext.description = 'A C library for neural networks.'
ext.organization = 'LinkedNeurons'

libraries {
    njgr {}
}

executables {
    test {
        binaries.all {
            cCompiler.args '-I', "/usr/local/include"
        }
    }
    display {
        binaries.all {
            cCompiler.args '-I', "/usr/local/include"
        }
    }
}

sources {
    njgr {
        c {
            source {
                include "**/*.c"
            }
        }
    }
    test {
        c {
            lib libraries.njgr
            source {
                include "**/*.c"
            }
        }
    }
	display {
		c {
			source {
				include "**/*.c"
			}
		}
	}
}

model {
    buildTypes {
        debug {}
        snapshot {}
        release {}
    }
}

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {}
}

task injectLibs << {
    linkTestExecutable.doFirst {
        binaries.all {
            toolChain.linker.withArguments { args ->
                if (!args.contains("-lcunit")) {
                    args << "-lcunit"
                }
                if (!args.contains("-lSDL")) {
                    args << "-lSDL"
                    args << "-lSDL_draw"
                }
            }
        }
    }
}

task runTests(type:Exec) {
    workingDir './build/install/testExecutable/'
    commandLine './test'
}

task test {}
task snapshot {}
task release {}

binaries.all {
    cCompiler.args "-Wall"

    if (toolChain in Gcc || toolChain in Clang) {
        cCompiler.args "-Wextra"
        cCompiler.args "--std=c99"
        if (buildType == buildTypes.debug) {
            cCompiler.args "-g"
        } else {
            cCompiler.args "-O3"
        }
    }
}
